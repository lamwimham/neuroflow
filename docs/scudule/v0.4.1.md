# 📋 NeuroFlow v0.4.1 开发计划
## Agent 模板与 MCP 默认配置专项

**文档版本**: 1.0  
**创建日期**: 2026-02-19  
**执行周期**: 2 周 (10 个工作日)  
**项目负责人**: [待分配]  
**开发团队**: Python SDK 组 + Rust Kernel 组

---

## 🎯 项目概述

### 目标
为 `neuroflow agent create` 命令提供生产级模板，默认集成 MCP 服务器 (filesystem + memory)，Terminal 默认禁用但可配置启用。

### 核心价值
- ✅ 新用户开箱即用，无需手动配置 MCP
- ✅ 安全优先，Terminal 默认禁用避免风险
- ✅ 模板化设计，支持不同场景快速创建 Agent

### 关键决策确认
| 配置项 | 决策 | 理由 |
|--------|------|------|
| 默认 MCP 服务器 | filesystem + memory | 基础能力，无需额外配置 |
| Terminal 策略 | 默认禁用 | 安全风险高，需用户主动启用 |
| 模板类型 | basic / standard / advanced | 满足不同复杂度需求 |

---

## 📦 工作分解结构 (WBS)

### 模块 1: Agent 模板系统 (Python SDK 组)

| ID | 任务 | 描述 | 负责人 | 工时 | 优先级 |
|:---|------|------|--------|:----:|:------:|
| **TPL-01** | 创建模板目录结构 | 建立 `templates/agent/` 目录，包含 basic/standard/advanced 三种模板 | 后端开发 A | 4h | P0 |
| **TPL-02** | 实现模板渲染引擎 | 开发 `TemplateRenderer` 类，支持变量替换和文件复制 | 后端开发 A | 8h | P0 |
| **TPL-03** | 编写 standard 模板 | 完成标准模板所有文件 (agent.py, config.yaml, AGENT.md 等) | 后端开发 A | 8h | P0 |
| **TPL-04** | 编写 basic 模板 | 完成基础模板 (最小可用) | 后端开发 A | 4h | P1 |
| **TPL-05** | 编写 advanced 模板 | 完成多 Agent 协作模板 | 后端开发 A | 8h | P2 |

### 模块 2: MCP 集成 (Python SDK 组)

| ID | 任务 | 描述 | 负责人 | 工时 | 优先级 |
|:---|------|------|--------|:----:|:------:|
| **MCP-01** | MCP 配置解析器 | 实现 `config.yaml` 中 MCP 配置的解析和验证 | 后端开发 B | 6h | P0 |
| **MCP-02** | 自动启动 MCP 服务器 | Agent 初始化时自动启动配置的 MCP 服务器 | 后端开发 B | 8h | P0 |
| **MCP-03** | filesystem MCP 集成 | 集成官方 filesystem MCP 服务器，配置安全路径 | 后端开发 B | 6h | P0 |
| **MCP-04** | memory MCP 集成 | 集成官方 memory MCP 服务器 | 后端开发 B | 6h | P0 |
| **MCP-05** | MCP 健康检查 | 实现 MCP 服务器连接状态检查和自动重试 | 后端开发 B | 4h | P1 |

### 模块 3: Terminal 安全模块 (Rust Kernel 组 + Python SDK 组)

| ID | 任务 | 描述 | 负责人 | 工时 | 优先级 |
|:---|------|------|--------|:----:|:------:|
| **TERM-01** | Terminal 配置解析 | 实现 Terminal 安全策略配置解析 | 后端开发 B | 4h | P0 |
| **TERM-02** | 命令白名单验证 | 实现命令白名单检查和拦截逻辑 | Rust 开发 A | 8h | P0 |
| **TERM-03** | 沙箱执行器 | 实现受限环境下的命令执行 (subprocess 限制) | Rust 开发 A | 12h | P0 |
| **TERM-04** | 敏感操作确认 | 实现需要用户确认的操作拦截机制 | 后端开发 B | 6h | P1 |
| **TERM-05** | 默认禁用逻辑 | 确保 config.yaml 中 terminal.enabled 默认为 false | 后端开发 B | 2h | P0 |

### 模块 4: CLI 增强 (Python SDK 组)

| ID | 任务 | 描述 | 负责人 | 工时 | 优先级 |
|:---|------|------|--------|:----:|:------:|
| **CLI-01** | agent create 命令增强 | 支持 `--template` 参数选择模板 | 后端开发 A | 6h | P0 |
| **CLI-02** | 交互式配置向导 | 创建 Agent 时交互式询问 MCP/Terminal 配置 | 后端开发 A | 8h | P1 |
| **CLI-03** | 配置验证命令 | 新增 `neuroflow agent validate` 命令 | 后端开发 A | 4h | P2 |

### 模块 5: 文档与测试 (文档组 + QA)

| ID | 任务 | 描述 | 负责人 | 工时 | 优先级 |
|:---|------|------|--------|:----:|:------:|
| **DOC-01** | Agent 模板使用文档 | 编写三种模板的使用说明和场景指南 | 技术文档 | 8h | P0 |
| **DOC-02** | MCP 配置指南 | 编写 MCP 服务器配置和安全策略文档 | 技术文档 | 6h | P0 |
| **DOC-03** | Terminal 安全文档 | 编写 Terminal 安全策略和最佳实践 | 技术文档 | 4h | P0 |
| **QA-01** | 单元测试 | 覆盖模板渲染、MCP 集成、Terminal 安全逻辑 | QA 工程师 | 12h | P0 |
| **QA-02** | 集成测试 | 端到端测试 Agent 创建和运行流程 | QA 工程师 | 8h | P0 |
| **QA-03** | 安全测试 | 验证 Terminal 沙箱逃逸防护 | QA 工程师 | 8h | P0 |

---

## 📅 时间线与里程碑

```
Week 1                          Week 2
├─────┬─────┬─────┬─────┬─────┼─────┬─────┬─────┬─────┬─────┤
  D1    D2    D3    D4    D5    D6    D7    D8    D9   D10
  │     │     │     │     │     │     │     │     │     │
  ▼     ▼     ▼     ▼     ▼     ▼     ▼     ▼     ▼     ▼
┌─────────────────┐   ┌─────────────────┐   ┌─────────────┐
│   模板开发      │   │   MCP 集成      │   │  测试与发布  │
│   TPL-01~05     │   │   MCP-01~05     │   │  QA-01~03   │
│   CLI-01        │   │   TERM-01~05    │   │  DOC-01~03  │
│   MCP-01        │   │   CLI-02        │   │  发布 v0.4.1│
└─────────────────┘   └─────────────────┘   └─────────────┘
        │                     │                     │
        ▼                     ▼                     ▼
   M1: 模板完成          M2: 集成完成          M3: 发布就绪
   (D3 结束)             (D7 结束)             (D10 结束)
```

### 里程碑定义

| 里程碑 | 时间点 | 交付物 | 验收标准 |
|--------|--------|--------|----------|
| **M1: 模板完成** | Day 3 | 三种模板文件完整 | `neuroflow agent create --template standard` 能生成完整项目 |
| **M2: 集成完成** | Day 7 | MCP + Terminal 集成 | Agent 能自动启动 MCP，Terminal 默认禁用 |
| **M3: 发布就绪** | Day 10 | 测试通过 + 文档完整 | 所有测试通过，文档网站更新 |

---

## ✅ 验收标准

### 功能验收

| 编号 | 测试场景 | 预期结果 | 优先级 |
|------|----------|----------|--------|
| **ACC-01** | 创建 standard 模板 Agent | 生成完整目录结构，包含 config.yaml | P0 |
| **ACC-02** | 启动 Agent | 自动连接 filesystem 和 memory MCP 服务器 | P0 |
| **ACC-03** | 检查 Terminal 状态 | 默认禁用，config.yaml 中 enabled: false | P0 |
| **ACC-04** | 手动启用 Terminal | 修改配置后可启用，受安全策略限制 | P0 |
| **ACC-05** | 文件读写测试 | Agent 可通过 MCP 读写 ./workspace 内文件 | P0 |
| **ACC-06** | 敏感路径访问 | 尝试访问 /etc 等路径被拒绝 | P0 |
| **ACC-07** | 命令白名单测试 | 允许的命令可执行，黑名单命令被拦截 | P0 |
| **ACC-08** | 模板切换 | --template basic/advanced 能生成对应模板 | P1 |

### 安全验收

| 编号 | 测试场景 | 预期结果 | 优先级 |
|------|----------|----------|--------|
| **SEC-01** | Terminal 沙箱逃逸 | 无法逃逸到工作目录外 | P0 |
| **SEC-02** | 危险命令拦截 | `rm -rf` 等命令被拒绝执行 | P0 |
| **SEC-03** | 管道命令拦截 | `curl | bash` 类命令被拒绝 | P0 |
| **SEC-04** | 资源限制 | 超时/超内存命令被终止 | P0 |
| **SEC-05** | 敏感文件保护 | .env, .ssh 等文件无法读取 | P0 |

### 性能验收

| 编号 | 指标 | 目标值 | 优先级 |
|------|------|--------|--------|
| **PERF-01** | Agent 启动时间 | < 5 秒 | P1 |
| **PERF-02** | MCP 连接时间 | < 2 秒 | P1 |
| **PERF-03** | 命令执行延迟 | < 100ms (简单命令) | P2 |
| **PERF-04** | 内存占用 | < 200MB (空闲状态) | P2 |

---

## 👥 责任分配矩阵 (RACI)

| 任务模块 | 产品经理 | 技术负责人 | Python 开发 | Rust 开发 | QA | 文档 |
|----------|:--------:|:----------:|:-----------:|:---------:|:--:|:----:|
| 模板系统 | C | A | R | - | I | I |
| MCP 集成 | C | A | R | C | I | I |
| Terminal 安全 | C | A | R | R | C | I |
| CLI 增强 | I | A | R | - | I | I |
| 文档 | I | I | C | C | I | R |
| 测试 | I | A | C | C | R | I |

**图例**: R=负责执行 | A=最终批准 | C=咨询 | I=知悉

---

## ⚠️ 风险管控

| 风险 | 概率 | 影响 | 缓解措施 | 负责人 |
|------|:----:|:----:|----------|--------|
| MCP 服务器兼容性问题 | 中 | 高 | 提前测试官方 MCP 服务器，准备备用方案 | 技术负责人 |
| Terminal 沙箱逃逸漏洞 | 低 | 极高 | 多层防护 (白名单 + 沙箱 + 资源限制)，安全审计 | Rust 开发 |
| 模板复杂度太高 | 中 | 中 | 保持 basic 模板简单，standard 模板可配置 | 产品经理 |
| 开发周期延期 | 中 | 中 | 每日站会跟踪进度，必要时削减 P2 功能 | 技术负责人 |
| API Key 管理不安全 | 中 | 高 | 使用环境变量，禁止硬编码，文档明确说明 | Python 开发 |

---

## 📁 交付物清单

### 代码交付

```
sdk/neuroflow/
├── templates/
│   └── agent/
│       ├── basic/
│       ├── standard/
│       └── advanced/
├── cli/commands/
│   └── agent.py              # 增强的 agent create 命令
├── mcp/
│   ├── config_parser.py      # MCP 配置解析
│   ├── server_manager.py     # MCP 服务器管理
│   └── health_check.py       # 健康检查
└── terminal/
    ├── executor.py           # Terminal 执行器
    ├── security_policy.py    # 安全策略
    └── sandbox.py            # 沙箱管理

kernel/src/
└── terminal/
    ├── mod.rs
    ├── executor.rs           # Rust 终端执行器
    └── security.rs           # 安全检查
```

### 文档交付

| 文档 | 路径 | 状态 |
|------|------|------|
| Agent 模板使用指南 | docs-site/docs/guides/agent-templates.md | ⬜ |
| MCP 配置指南 | docs-site/docs/guides/mcp-configuration.md | ⬜ |
| Terminal 安全最佳实践 | docs-site/docs/guides/terminal-security.md | ⬜ |
| config.yaml 参考 | docs-site/docs/reference/config-yaml.md | ⬜ |
| 发布说明 | docs/RELEASE_NOTES_v0.4.1.md | ⬜ |

### 测试交付

| 测试类型 | 文件 | 覆盖率目标 |
|----------|------|------------|
| 单元测试 | tests/test_templates.py | 80% |
| 单元测试 | tests/test_mcp_integration.py | 80% |
| 单元测试 | tests/test_terminal_security.py | 90% |
| 集成测试 | tests/integration/test_agent_create.py | - |
| 安全测试 | tests/security/test_sandbox_escape.py | - |

---

## 🔄 每日站会检查项

### 开发团队每日同步 (15 分钟)

1. **昨天完成了什么？**
2. **今天计划做什么？**
3. **有什么阻塞问题？**

### 关键检查点

| 时间点 | 检查项 | 负责人 |
|--------|--------|--------|
| Day 1 结束 | 模板目录结构创建完成 | Python 开发 A |
| Day 3 结束 | M1 里程碑验收 | 技术负责人 |
| Day 5 结束 | MCP 集成初步完成 | Python 开发 B |
| Day 7 结束 | M2 里程碑验收 | 技术负责人 |
| Day 9 结束 | 所有测试通过 | QA 工程师 |
| Day 10 结束 | M3 里程碑验收，发布 | 技术负责人 |

---

## 📞 沟通与协作

### 沟通渠道
- **日常沟通**: Slack/钉钉 #neuroflow-dev 频道
- **代码审查**: GitHub Pull Request
- **文档协作**: Notion/语雀
- **问题追踪**: GitHub Issues

### 会议安排
| 会议 | 时间 | 参与人 |
|------|------|--------|
| 每日站会 | 每天 10:00 (15 分钟) | 全体开发 |
| 周中检查 | Week 1 Day 5 (30 分钟) | 技术负责人 + 开发 |
| 冲刺评审 | Week 2 Day 10 (1 小时) | 全体 + 产品经理 |

---

## 🚀 启动检查清单

在开发开始前，请确认以下事项：

- [ ] 开发环境准备完成 (Python 3.10+, Rust 1.70+, Node.js 18+)
- [ ] GitHub 分支 `feat/v0.4.1-agent-templates` 已创建
- [ ] 开发人员已分配并确认任务
- [ ] 官方 MCP 服务器已测试可用
- [ ] 测试环境准备完成
- [ ] 文档站点部署权限已确认

---

## 📊 成功指标

| 指标 | 目标值 | 测量方式 |
|------|--------|----------|
| 新用户创建 Agent 时间 | < 5 分钟 | 用户测试 |
| 模板使用率 | > 80% 使用 standard 模板 | 使用统计 |
| 安全事故 | 0 | 安全审计 |
| 测试覆盖率 | > 80% | CI/CD 报告 |
| 文档完整性 | 100% 功能有文档 | 文档审查 |

---

**批准签字**:

| 角色 | 姓名 | 签字 | 日期 |
|------|------|------|------|
| 产品经理 | | | |
| 技术负责人 | | | |
| 开发代表 | | | |

---

**文档结束**

---

## 📝 附：快速参考卡片

### 开发人员快速开始

```bash
# 1. 拉取最新代码
git checkout develop
git pull origin develop

# 2. 创建功能分支
git checkout -b feat/v0.4.1-agent-templates

# 3. 安装依赖
cd sdk && pip install -e ".[dev]"
cd kernel && cargo build

# 4. 运行测试
cd sdk && pytest tests/
cd kernel && cargo test

# 5. 提交代码
git add .
git commit -m "feat: [任务 ID] 任务描述"
git push origin feat/v0.4.1-agent-templates
```

### 关键配置示例

```yaml
# config.yaml 关键配置
mcp:
  servers:
    - name: filesystem
      enabled: true  # ✅ 默认启用
    - name: memory
      enabled: true  # ✅ 默认启用

terminal:
  enabled: false  # ⚠️ 默认禁用
  mode: restricted
```

---

**请将此文档分发给开发团队，如有任何问题请及时沟通！** 🚀