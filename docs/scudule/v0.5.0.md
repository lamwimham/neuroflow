# 📋 NeuroFlow v0.5.0 开发计划
## 性能优化与安全增强专项

**文档版本**: 1.0  
**创建日期**: 2026-03-20  
**执行周期**: 4 周 (20 个工作日)  
**版本号**: v0.5.0  
**前置版本**: v0.4.2 ✅  
**版本类型**: Minor Release (功能增强)

---

## 🎯 项目概述

### 背景
v0.4.2 完成了真实 MCP 集成和 A2A 通信，但 **沙箱安全优化** 因技术复杂度延期。v0.5.0 将重点完成沙箱增强，同时引入性能优化、可观测性、Web 控制台等生产级功能。

### 目标
| 目标 | 描述 | 优先级 |
|------|------|--------|
| **沙箱安全增强** | 完成 v0.4.2 延期的 namespace 隔离和资源限制 | P0 |
| **性能优化** | Rust Gateway 性能基准与优化 | P0 |
| **可观测性** | OpenTelemetry 集成，全链路追踪 | P0 |
| **Web 控制台** | 管理界面 MVP，可视化 Agent 管理 | P1 |
| **Skill 市场** | Skill 模板库和分享机制 | P1 |

### 核心价值
- ✅ 安全性达到生产标准 (沙箱隔离完善)
- ✅ 性能可量化、可优化 (基准测试 + 优化)
- ✅ 运维可视化 (Web 控制台 + 链路追踪)
- ✅ 生态初步建立 (Skill 模板库)

---

## 📊 v0.4.2 遗留问题回顾

| 问题 | 原计划 | 延期原因 | v0.5.0 解决方案 |
|------|--------|----------|----------------|
| **沙箱 namespace 隔离** | SEC-101 | 技术复杂度高，需 Rust 内核深度修改 | 分阶段实现，先 Linux namespace，后 Docker |
| **网络访问控制** | SEC-102 | 依赖 namespace 完成 | 与 namespace 一起实现 |
| **gRPC 通信协议** | A2A-103 | 优先级低于 HTTP | 作为可选增强功能 |
| **性能基准测试** | QA-104 | 时间不足 | 建立完整基准测试套件 |

---

## 📦 工作分解结构 (WBS)

### 模块 1: 沙箱安全增强 (Rust Kernel 组) ⭐ 重点

| ID | 任务 | 描述 | 负责人 | 工时 | 优先级 |
|:---|------|------|--------|:----:|:------:|
| **SANDBOX-101** | Linux namespace 隔离 | 实现 PID/Network/Mount namespace 隔离 | Rust 开发 A | 24h | P0 |
| **SANDBOX-102** | 网络访问控制 | 限制沙箱内网络访问 (白名单) | Rust 开发 A | 16h | P0 |
| **SANDBOX-103** | 文件系统隔离增强 | 使用 overlayfs 实现写时复制 | Rust 开发 B | 20h | P0 |
| **SANDBOX-104** | 资源限制强化 | cgroups v2 CPU/内存限制 | Rust 开发 A | 16h | P0 |
| **SANDBOX-105** | seccomp 系统调用过滤 | 限制危险系统调用 | Rust 开发 B | 20h | P1 |
| **SANDBOX-106** | 沙箱配置模板 | 提供不同安全级别的配置模板 | 后端开发 A | 8h | P1 |
| **SANDBOX-107** | 沙箱监控指标 | 暴露沙箱资源使用指标 | Rust 开发 A | 8h | P2 |

### 模块 2: 性能优化 (Rust Kernel 组 + Python SDK 组)

| ID | 任务 | 描述 | 负责人 | 工时 | 优先级 |
|:---|------|------|--------|:----:|:------:|
| **PERF-101** | 性能基准测试套件 | 建立完整的性能测试框架 | QA 工程师 | 16h | P0 |
| **PERF-102** | Gateway 性能分析 | 使用 perf/flamegraph 分析瓶颈 | Rust 开发 A | 12h | P0 |
| **PERF-103** | 工具路由优化 | 优化 Rust tool_router 查询性能 | Rust 开发 B | 16h | P0 |
| **PERF-104** | 连接池优化 | MCP/A2A 连接复用优化 | 后端开发 B | 12h | P1 |
| **PERF-105** | 内存管理优化 | 减少 Python-Rust FFI 内存拷贝 | Rust 开发 A | 16h | P1 |
| **PERF-106** | 并发能力测试 | 测试 100+ 并发 Agent 支持 | QA 工程师 | 12h | P1 |
| **PERF-107** | 性能优化报告 | 输出 v0.4.x vs v0.5.0 对比报告 | QA 工程师 | 8h | P2 |

### 模块 3: 可观测性 (Python SDK 组 + Rust Kernel 组)

| ID | 任务 | 描述 | 负责人 | 工时 | 优先级 |
|:---|------|------|--------|:----:|:------:|
| **OBS-101** | OpenTelemetry 集成 | 集成 OTLP 协议，支持主流后端 | 后端开发 A | 16h | P0 |
| **OBS-102** | 链路追踪 | LLM 调用、工具执行、A2A 通信全链路追踪 | 后端开发 B | 16h | P0 |
| **OBS-103** | 指标收集 | 请求数、延迟、错误率等指标 | Rust 开发 A | 12h | P0 |
| **OBS-104** | 日志标准化 | 统一日志格式，支持结构化日志 | 后端开发 A | 8h | P1 |
| **OBS-105** | Dashboard 模板 | 提供 Grafana/Prometheus 配置模板 | 后端开发 B | 8h | P1 |
| **OBS-106** | 告警规则 | 定义关键指标告警规则 | 后端开发 B | 6h | P2 |

### 模块 4: Web 控制台 MVP (前端组 + Python SDK 组)

| ID | 任务 | 描述 | 负责人 | 工时 | 优先级 |
|:---|------|------|--------|:----:|:------:|
| **WEB-101** | 前端框架搭建 | React + TypeScript + TailwindCSS | 前端开发 A | 16h | P0 |
| **WEB-102** | Agent 管理界面 | 创建/查看/删除 Agent | 前端开发 A | 20h | P0 |
| **WEB-103** | 对话调试界面 | 实时查看 Agent 对话和工具调用 | 前端开发 B | 20h | P0 |
| **WEB-104** | Skill 管理界面 | 查看/分配/测试 Skills | 前端开发 A | 16h | P1 |
| **WEB-105** | 监控 Dashboard | 显示性能指标和运行状态 | 前端开发 B | 16h | P1 |
| **WEB-106** | API 网关 | Web 控制台后端 API 服务 | 后端开发 A | 20h | P0 |
| **WEB-107** | 认证授权 | 基础 JWT 认证 | 后端开发 B | 12h | P1 |

### 模块 5: Skill 市场 (Python SDK 组)

| ID | 任务 | 描述 | 负责人 | 工时 | 优先级 |
|:---|------|------|--------|:----:|:------:|
| **SKILL-101** | Skill 模板库 | 官方维护 10+ 预置 Skills | 后端开发 A | 24h | P0 |
| **SKILL-102** | Skill 导入/导出 | 支持 Skill 包导入导出 | 后端开发 B | 12h | P0 |
| **SKILL-103** | Skill 版本管理 | SemVer 版本控制和兼容性检查 | 后端开发 B | 12h | P1 |
| **SKILL-104** | Skill 发现机制 | 本地/远程 Skill 发现 | 后端开发 A | 12h | P1 |
| **SKILL-105** | Skill 评分系统 | 用户评分和评论 (本地) | 后端开发 A | 8h | P2 |

### 模块 6: 文档与测试 (文档组 + QA)

| ID | 任务 | 描述 | 负责人 | 工时 | 优先级 |
|:---|------|------|--------|:----:|:------:|
| **DOC-101** | 沙箱安全白皮书 | 详细说明沙箱架构和安全机制 | 技术文档 | 16h | P0 |
| **DOC-102** | 性能优化指南 | 性能调优最佳实践 | 技术文档 | 12h | P0 |
| **DOC-103** | 可观测性指南 | 链路追踪和监控配置 | 技术文档 | 12h | P0 |
| **DOC-104** | Web 控制台文档 | 使用指南和部署说明 | 技术文档 | 8h | P1 |
| **DOC-105** | Skill 市场文档 | Skill 开发和分享指南 | 技术文档 | 8h | P1 |
| **QA-101** | 沙箱安全测试 | 逃逸测试、渗透测试 | QA 工程师 | 24h | P0 |
| **QA-102** | 性能回归测试 | 确保优化不引入回归 | QA 工程师 | 16h | P0 |
| **QA-103** | Web 控制台测试 | UI 测试、API 测试 | QA 工程师 | 16h | P1 |
| **QA-104** | 端到端测试 | 完整用户流程测试 | QA 工程师 | 16h | P0 |

---

## 📅 时间线与里程碑

```
Week 1              Week 2              Week 3              Week 4
├───┬───┬───┬───┬───┼───┬───┬───┬───┬───┼───┬───┬───┬───┬───┼───┬───┬───┬───┬───┤
 D1  D2  D3  D4  D5  D6  D7  D8  D9 D10 D11 D12 D13 D14 D15 D16 D17 D18 D19 D20
 │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │   │
 ▼   ▼   ▼   ▼   ▼   ▼   ▼   ▼   ▼   ▼   ▼   ▼   ▼   ▼   ▼   ▼   ▼   ▼   ▼   ▼
┌───────────────────┐ ┌───────────────────┐ ┌───────────────────┐ ┌───────────────┐
│   沙箱安全增强    │ │   性能优化        │ │   可观测性        │ │  测试与发布   │
│   SANDBOX-101~107 │ │   PERF-101~107    │ │   OBS-101~106     │ │  QA-101~104   │
│   WEB-101~102     │ │   WEB-103~104     │ │   WEB-105~107     │ │  DOC-101~105  │
│   SKILL-101       │ │   SKILL-102~103   │ │   SKILL-104~105   │ │  发布 v0.5.0  │
└───────────────────┘ └───────────────────┘ └───────────────────┘ └───────────────┘
        │                     │                     │                     │
        ▼                     ▼                     ▼                     ▼
   M1: 沙箱完成          M2: 性能完成          M3: 可观测完成        M4: 发布就绪
   (D5 结束)             (D10 结束)            (D15 结束)            (D20 结束)
```

### 里程碑定义

| 里程碑 | 时间点 | 交付物 | 验收标准 |
|--------|--------|--------|----------|
| **M1: 沙箱完成** | Day 5 | namespace 隔离可用 | 沙箱逃逸测试全部通过 |
| **M2: 性能完成** | Day 10 | 基准测试报告 | 关键指标提升 30%+ |
| **M3: 可观测完成** | Day 15 | 链路追踪可用 | 全链路追踪覆盖率 100% |
| **M4: 发布就绪** | Day 20 | 测试通过 + 文档完整 | 所有测试通过，Web 控制台可用 |

---

## ✅ 验收标准

### 沙箱安全验收

| 编号 | 测试场景 | 预期结果 | 优先级 |
|------|----------|----------|--------|
| **SANDBOX-ACC-01** | PID namespace 隔离 | 沙箱内只能看到自身进程 | P0 |
| **SANDBOX-ACC-02** | Network namespace 隔离 | 沙箱内网络访问受限制 | P0 |
| **SANDBOX-ACC-03** | Mount namespace 隔离 | 沙箱内文件系统隔离 | P0 |
| **SANDBOX-ACC-04** | cgroups 资源限制 | CPU/内存超限自动终止 | P0 |
| **SANDBOX-ACC-05** | seccomp 系统调用过滤 | 危险系统调用被拦截 | P0 |
| **SANDBOX-ACC-06** | 文件系统逃逸 | 无法访问工作目录外文件 | P0 |
| **SANDBOX-ACC-07** | 网络逃逸 | 无法访问未授权网络地址 | P0 |
| **SANDBOX-ACC-08** | 提权攻击 | 无法获取 root 权限 | P0 |

### 性能验收

| 编号 | 指标 | v0.4.2 基线 | v0.5.0 目标 | 优先级 |
|------|------|-------------|-------------|--------|
| **PERF-ACC-01** | Gateway 延迟 (P50) | 15ms | < 10ms | P0 |
| **PERF-ACC-02** | Gateway 延迟 (P99) | 50ms | < 30ms | P0 |
| **PERF-ACC-03** | 工具调用延迟 | 80ms | < 50ms | P0 |
| **PERF-ACC-04** | A2A 通信延迟 | 150ms | < 100ms | P1 |
| **PERF-ACC-05** | 并发 Agent 支持 | 50 | > 100 | P1 |
| **PERF-ACC-06** | 内存占用 (空闲) | 250MB | < 200MB | P2 |
| **PERF-ACC-07** | 沙箱启动时间 | 200ms | < 100ms | P1 |

### 可观测性验收

| 编号 | 测试场景 | 预期结果 | 优先级 |
|------|----------|----------|--------|
| **OBS-ACC-01** | 链路追踪完整性 | 所有请求可追踪 | P0 |
| **OBS-ACC-02** | 指标收集准确性 | 指标数据准确无误 | P0 |
| **OBS-ACC-03** | Grafana Dashboard | 预置 Dashboard 可用 | P1 |
| **OBS-ACC-04** | 告警触发 | 关键指标超阈值告警 | P1 |
| **OBS-ACC-05** | 日志查询 | 支持结构化日志查询 | P1 |

### Web 控制台验收

| 编号 | 测试场景 | 预期结果 | 优先级 |
|------|----------|----------|--------|
| **WEB-ACC-01** | Agent 管理 | 创建/查看/删除 Agent | P0 |
| **WEB-ACC-02** | 对话调试 | 实时查看对话和工具调用 | P0 |
| **WEB-ACC-03** | Skill 管理 | 查看/分配 Skills | P1 |
| **WEB-ACC-04** | 监控 Dashboard | 显示性能指标 | P1 |
| **WEB-ACC-05** | 认证授权 | JWT 认证正常工作 | P1 |

### Skill 市场验收

| 编号 | 测试场景 | 预期结果 | 优先级 |
|------|----------|----------|--------|
| **SKILL-ACC-01** | 预置 Skills | 10+ 官方 Skills 可用 | P0 |
| **SKILL-ACC-02** | Skill 导入/导出 | 支持 Skill 包导入导出 | P0 |
| **SKILL-ACC-03** | 版本管理 | SemVer 版本控制正常 | P1 |
| **SKILL-ACC-04** | Skill 发现 | 本地/远程发现正常 | P1 |

---

## 👥 责任分配矩阵 (RACI)

| 任务模块 | 产品经理 | 技术负责人 | Python 开发 | Rust 开发 | 前端开发 | QA | 文档 |
|----------|:--------:|:----------:|:-----------:|:---------:|:---------:|:--:|:----:|
| 沙箱安全增强 | C | A | C | R | - | C | I |
| 性能优化 | C | A | R | R | - | R | I |
| 可观测性 | C | A | R | R | - | C | I |
| Web 控制台 | C | A | R | C | R | C | I |
| Skill 市场 | C | A | R | - | - | C | I |
| 文档 | I | I | C | C | C | I | R |
| 测试 | I | A | C | C | C | R | I |

**图例**: R=负责执行 | A=最终批准 | C=咨询 | I=知悉

---

## ⚠️ 风险管控

| 风险 | 概率 | 影响 | 缓解措施 | 负责人 |
|------|:----:|:----:|----------|--------|
| namespace 隔离兼容性问题 | 中 | 高 | 支持降级到 subprocess 模式，提供配置选项 | Rust 开发 A |
| 性能优化不达预期 | 中 | 中 | 早期基准测试，及时调整优化方向 | 技术负责人 |
| Web 控制台延期 | 中 | 中 | 优先保证核心功能，可选功能延后 | 前端开发 A |
| seccomp 配置复杂 | 高 | 中 | 提供预置安全配置文件，减少手动配置 | Rust 开发 B |
| 跨平台支持问题 | 中 | 中 | 优先支持 Linux，macOS/Windows 部分功能降级 | 技术负责人 |
| 安全漏洞 | 低 | 极高 | 外部安全审计，漏洞赏金计划 | QA 工程师 |

---

## 📁 交付物清单

### 代码交付

```
sdk/neuroflow/
├── sandbox/
│   ├── namespace_isolator.py     # 新增：namespace 隔离
│   ├── network_controller.py     # 新增：网络控制
│   ├── resource_limiter.py       # 新增：资源限制
│   └── seccomp_profile.py        # 新增：seccomp 配置
├── observability/
│   ├── tracing.py                # 新增：链路追踪
│   ├── metrics.py                # 新增：指标收集
│   └── logging.py                # 增强：结构化日志
├── web/
│   ├── server.py                 # 新增：Web 控制台后端
│   └── api/                      # 新增：API 路由
│       ├── agents.py
│       ├── skills.py
│       └── monitoring.py
├── skills/
│   ├── marketplace.py            # 新增：Skill 市场
│   ├── version_manager.py        # 新增：版本管理
│   └── templates/                # 新增：10+ 预置 Skills
│       ├── web-search/
│       ├── data-analysis/
│       ├── code-review/
│       └── ...
└── examples/
    ├── monitored-agent/          # 新增：带监控的 Agent
    └── multi-agent-team/         # 增强：多 Agent 协作

kernel/src/
├── sandbox/
│   ├── namespace.rs              # 新增：namespace 隔离
│   ├── network.rs                # 新增：网络控制
│   ├── cgroups.rs                # 新增：cgroups 限制
│   └── seccomp.rs                # 新增：seccomp 过滤
├── observability/
│   ├── tracing.rs                # 新增：链路追踪
│   └── metrics.rs                # 新增：指标收集
└── gateway/
    └── optimizer.rs              # 新增：性能优化

web-console/
├── src/
│   ├── components/               # React 组件
│   ├── pages/                    # 页面
│   └── api/                      # API 客户端
├── package.json
└── README.md
```

### 文档交付

| 文档 | 路径 | 状态 |
|------|------|------|
| 沙箱安全白皮书 | docs-site/docs/security/sandbox-whitepaper.md | ⬜ |
| 性能优化指南 | docs-site/docs/guides/performance-optimization.md | ⬜ |
| 可观测性配置指南 | docs-site/docs/guides/observability.md | ⬜ |
| Web 控制台使用指南 | docs-site/docs/guides/web-console.md | ⬜ |
| Skill 开发指南 | docs-site/docs/guides/skill-development.md | ⬜ |
| 预置 Skills 目录 | docs-site/docs/skills/overview.md | ⬜ |
| 发布说明 | docs/RELEASE_NOTES_v0.5.0.md | ⬜ |
| 迁移指南 | docs/MIGRATION_v0.4.x_to_v0.5.0.md | ⬜ |

### 测试交付

| 测试类型 | 文件 | 覆盖率目标 |
|----------|------|------------|
| 沙箱安全测试 | tests/security/test_namespace_isolation.py | 95% |
| 沙箱逃逸测试 | tests/security/test_sandbox_escape.py | 95% |
| 性能基准测试 | tests/perf/benchmark_v0.5.0.py | - |
| 可观测性测试 | tests/observability/test_tracing.py | 85% |
| Web 控制台测试 | tests/web/test_console.py | 80% |
| 端到端测试 | tests/e2e/test_full_workflow.py | - |

---

## 🔄 每周冲刺计划

### Week 1: 沙箱安全增强

| 日期 | 任务 | 交付物 |
|------|------|--------|
| D1 | namespace 隔离框架设计 | 设计文档 |
| D2-D3 | PID/Mount namespace 实现 | 代码 + 单元测试 |
| D4-D5 | Network namespace + 资源限制 | 代码 + 单元测试 |
| D5 | M1 里程碑验收 | 验收报告 |

### Week 2: 性能优化

| 日期 | 任务 | 交付物 |
|------|------|--------|
| D6 | 基准测试套件搭建 | 测试框架 |
| D7-D8 | Gateway 性能分析与优化 | 优化代码 |
| D9-D10 | 连接池和内存优化 | 优化代码 |
| D10 | M2 里程碑验收 + 性能报告 | 性能报告 |

### Week 3: 可观测性 + Web 控制台

| 日期 | 任务 | 交付物 |
|------|------|--------|
| D11-D12 | OpenTelemetry 集成 | 追踪代码 |
| D13-D14 | Web 控制台核心功能 | 前端 + 后端 |
| D15 | M3 里程碑验收 | 验收报告 |

### Week 4: 测试与发布

| 日期 | 任务 | 交付物 |
|------|------|--------|
| D16-D17 | 全面测试 (安全/性能/功能) | 测试报告 |
| D18-D19 | 文档完善 + Bug 修复 | 文档 + 修复 |
| D20 | M4 里程碑验收 + 发布 | v0.5.0 Release |

---

## 📞 沟通与协作

### 沟通渠道
- **日常沟通**: Slack/钉钉 #neuroflow-dev 频道
- **代码审查**: GitHub Pull Request
- **文档协作**: Notion/语雀
- **问题追踪**: GitHub Issues
- **安全讨论**: 私密频道 #neuroflow-security

### 会议安排
| 会议 | 时间 | 参与人 | 时长 |
|------|------|--------|------|
| 每日站会 | 每天 10:00 | 全体开发 | 15 分钟 |
| 技术评审 | 每周二 14:00 | 技术负责人 + 开发 | 1 小时 |
| 安全评审 | 每周四 14:00 | Rust 开发 + QA | 1 小时 |
| 周中检查 | 每周五 16:00 | 技术负责人 + 产品经理 | 30 分钟 |
| 冲刺评审 | 每周五 17:00 | 全体 + 产品经理 | 1 小时 |

---

## 🚀 启动检查清单

在开发开始前，请确认以下事项：

- [ ] v0.4.2 已正式发布并打 tag
- [ ] GitHub 分支 `feat/v0.5.0-performance-security` 已创建
- [ ] 开发人员已分配并确认任务
- [ ] 测试环境准备完成 (Linux 环境用于沙箱测试)
- [ ] 性能测试基准环境准备完成
- [ ] Web 控制台开发环境准备完成 (Node.js 18+)
- [ ] OpenTelemetry 后端准备完成 (Jaeger/Prometheus)
- [ ] 安全审计计划已制定

---

## 📊 成功指标

| 指标 | 目标值 | 测量方式 |
|------|--------|----------|
| 沙箱逃逸漏洞 | 0 | 安全审计 |
| 性能提升 | 30%+ | 基准测试对比 |
| 链路追踪覆盖率 | 100% | 追踪数据 |
| Web 控制台可用性 | 99% | 监控数据 |
| 测试覆盖率 | > 85% | CI/CD 报告 |
| 预置 Skills 数量 | 10+ | 手动验证 |
| 文档完整性 | 100% 功能有文档 | 文档审查 |
| 严重 Bug 数 | 0 | 测试报告 |

---

## 🎯 v0.6.0 预览 (下一步规划)

v0.5.0 完成后，v0.6.0 将聚焦于：

| 模块 | 计划内容 | 预计时间 |
|------|----------|----------|
| **生产部署** | Docker/K8s 部署指南和 Helm Chart | 2 周 |
| **插件系统** | 第三方插件开发和加载机制 | 3 周 |
| **Skill 云市场** | 在线 Skill 分享和下载平台 | 3 周 |
| **高级协作** | 复杂工作流编排和状态管理 | 2 周 |
| **企业功能** | RBAC、审计日志、SSO | 3 周 |

---

## 🔧 技术决策记录

### 沙箱隔离方案

| 方案 | 优点 | 缺点 | 决策 |
|------|------|------|------|
| subprocess 限制 | 简单，跨平台 | 安全性低 | ✅ 降级方案 |
| Linux namespace | 安全性好，性能好 | 仅 Linux | ✅ 默认方案 |
| Docker/gVisor | 安全性最高 | 重量级，依赖多 | ❌ 后续版本 |

### 可观测性后端

| 方案 | 优点 | 缺点 | 决策 |
|------|------|------|------|
| Jaeger + Prometheus | 成熟，开源 | 需要额外部署 | ✅ 推荐 |
| Grafana Cloud | 托管，易用 | 付费 | ✅ 可选 |
| 自研后端 | 定制灵活 | 开发成本高 | ❌ 暂不采用 |

### Web 控制台部署

| 方案 | 优点 | 缺点 | 决策 |
|------|------|------|------|
| 独立服务 | 解耦，可独立扩展 | 需要额外部署 | ✅ 生产环境 |
| 嵌入式 | 简单，单进程 | 耦合度高 | ✅ 开发环境 |
| SaaS | 无需部署 | 数据隐私 | ❌ 暂不采用 |

---

**批准签字**:

| 角色 | 姓名 | 签字 | 日期 |
|------|------|------|------|
| 产品经理 | | | |
| 技术负责人 | | | |
| 开发代表 | | | |
| QA 负责人 | | | |

---

**文档结束**

---

## 📝 附：沙箱安全架构详解

### namespace 隔离架构图

```
┌─────────────────────────────────────────────────────────────┐
│                      Host System                            │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────┐    │
│  │              NeuroFlow Sandbox Manager              │    │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │    │
│  │  │     PID     │  │   Network   │  │    Mount    │  │    │
│  │  │  Namespace  │  │  Namespace  │  │  Namespace  │  │    │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  │    │
│  │  ┌─────────────────────────────────────────────────┐  │    │
│  │  │              cgroups v2 Limits                  │  │    │
│  │  │         CPU: 50%  |  Memory: 256MB              │  │    │
│  │  └─────────────────────────────────────────────────┘  │    │
│  │  ┌─────────────────────────────────────────────────┐  │    │
│  │  │              seccomp Profile                    │  │    │
│  │  │         Block: ptrace, mount, reboot            │  │    │
│  │  └─────────────────────────────────────────────────┘  │    │
│  └─────────────────────────────────────────────────────┘    │
│                              ↓                                │
│  ┌─────────────────────────────────────────────────────┐    │
│  │              Isolated Command Execution             │    │
│  │         Working Directory: ./workspace              │    │
│  │         Network: Whitelist Only                     │    │
│  └─────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────┘
```

### seccomp 默认配置文件

```json
{
  "defaultAction": "SCMP_ACT_ERRNO",
  "architectures": ["SCMP_ARCH_X86_64"],
  "syscalls": [
    {
      "names": ["read", "write", "open", "close", "stat", "fstat"],
      "action": "SCMP_ACT_ALLOW"
    },
    {
      "names": ["execve", "clone", "fork", "vfork"],
      "action": "SCMP_ACT_ALLOW"
    },
    {
      "names": ["ptrace", "mount", "umount", "reboot", "kexec_load"],
      "action": "SCMP_ACT_ERRNO"
    }
  ]
}
```

---

**请将此文档分发给开发团队，如有任何问题请及时沟通！** 🚀